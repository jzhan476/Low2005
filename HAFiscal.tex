% -*- Mode: LaTeX; TeX-PDF-mode: t; -*-  # Config emacs auctex
\input{./._relpath-to-latexroot.ltx}    % Set paths to find resources (defines \latexroot and loads tex-paths.ltx)

\documentclass[titlepage, headings=optiontotocandhead]{econark} % embedded toc

% Definitions unique to this paper (showlabels config now in local.sty)
\usepackage{local}                % Local package definitions and setup
\usepackage{local-qe}             % local-qe gets pkgs req for qe

\bibliographystyle{econark}       % based on econometrica

% Load metadata BEFORE hypersetup (SST pattern)
\input{\latexroot/@local/metadata.ltx}

% When compiling Web version of paper, construct targets/anchors
\weborpdf{ % compiling web version
  % execute this version if compiling with make4ht
  \hypersetup{destlabel=true} % set up html labels

}{
  % execute this version if compiling with pdflatex
  \provideboolean{showPageHead}{\setboolean{showPageHead}{true}}

  % Enhanced PDF metadata for AI systems and cross-format discovery
  % Uses macros from @local/metadata.ltx (SST pattern)
  \hypersetup{
    pdftitle={\PDFTitle},
    pdfauthor={\PDFAuthor},
    pdfsubject={\PDFSubject},
    pdfkeywords={\PDFKeywords}
  }
}

\webonly{ % footnotes do not work when there is no page footer
  % execute this version if compiling with make4ht
  \section*{Endnotes}
  \theendnotes
}

\begin{document}
% \whenstandalone{content} - Execute content only when file compiled standalone
% \whenintegrated{content} - Execute content only when integrated into main document

\subfile{Subfiles/HAFiscal-titlepage}\pagebreak

% Table of contents; to omit, \setboolean{TOC}{false} above 
\ifthenelse{\boolean{TOC}}{\pagebreak
  \let\LaTeXStandardContentsName\contentsname
  \renewcommand{\contentsname}{}
  \tableofcontents
}{}

% make the body of the paper
\input{Subfiles.ltx} % all sections are subfiles enumerated here 

\pagebreak

\webonly{
  % execute this version if compiling with make4ht
  \section*{Endnotes}
  \theendnotes
}

\addcontentsline{toc}{section}{References} % Add refs at end of TOC
% Bibliography handled automatically by document structure (\entrypointbib in preamble)
% This ensures proper bibliography handling in modular documents

\clearpage
% Citations from appendices that are not explicitly cited in main text
% These ensure the references appear in the bibliography
\nocite{Bardoczy2022}
\nocite{Blanchard2010}
\nocite{Christiano2016}
\nocite{DenHaan2000}
\nocite{Gornemann2021}
\nocite{Ravn2017}
\nocite{Ravn2021}
\nocite{Rotemberg1982}
\nocite{Silva2009}
\nocite{arsJumpsHumps}
\nocite{carroll2020modeling}
\nocite{den2010computational}
\nocite{fagereng-mpc-2021}
\nocite{rothstein2017scraping}
\smartbib

\clearpage
\section*{Appendices}
\addcontentsline{toc}{section}{Appendices}
\markboth{APPENDICES}{APPENDICES}

\appendix
% Include appendices based on their type and OnlineAppendixHandling

% A: HANK appendix (always include full content) - moved from B to A
\subfile{Subfiles/Appendix-HANK}

% B: No Splurge appendix - now online only with stub page
% Add pagebreak so Appendix B can be easily removed by dropping last page(s)
\clearpage
\FloatBarrier
\phantomsection
\section{\href{https://econ-ark.github.io/HAFiscal/\#app:Model-without-splurge}{Results in a Model Without the Splurge}}
\label{app:Model-without-splurge}

\noindent\textit{Full appendix PDF available at:}
\href{https://github.com/econ-ark/HAFiscal/blob/master/Subfiles/Appendix-NoSplurge.pdf}{\texttt{GitHub: Subfiles/Appendix-NoSplurge.pdf}}

\medskip
\noindent\textit{Click any section title below to view it online in HTML:}

\medskip

\subsection{\href{https://econ-ark.github.io/HAFiscal/\#app:Model-without-splurge-intro}{Introduction}}
\label{app:Model-without-splurge-intro}

\subsection{\href{https://econ-ark.github.io/HAFiscal/\#app:nosplurge-matching-impcs}{Matching the iMPCs without the splurge}}
\label{app:nosplurge-matching-impcs}

\subsection{\href{https://econ-ark.github.io/HAFiscal/\#app:nosplurge-estimating-betas}{Estimating discount factor distributions without the splurge}}
\label{app:nosplurge-estimating-betas}

\subsection{\href{https://econ-ark.github.io/HAFiscal/\#app:nosplurge-multipliers}{Multipliers in the absence of the splurge}}
\label{app:nosplurge-multipliers}

\medskip

% C: Robustness appendix (using hidden appendix approach)
% This appendix is processed for labels but doesn't appear in the PDF
\begin{hiddencontent}[OnlineAppendix]
  % Include the actual appendix content but it will be hidden
  \subfile{Subfiles/Appendix-Robustness}
\end{hiddencontent}

\end{document}
